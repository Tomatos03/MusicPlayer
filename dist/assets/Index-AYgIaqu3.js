import{u as D,r as f,w as te,o as j,a as v,c as C,b as e,d as N,e as _,f as s,g as d,h as M,i as G,j as oe,k as A,F,l as B,t as w,n as J,m as se,p as W,q as P,s as ne,v as ae,R as le,x as re}from"./index-Cmw_d75W.js";import{r as H}from"./request-qcfbbcHn.js";import{g as q,a as ce,h as O}from"./utils-B4ujTfZE.js";import{_ as U}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./province-mXtWvQn7.js";const ie={key:0,class:"captcha-login"},ue=["src"],de=2e3,me={__name:"CaptchaLogin",props:{activeIndex:{type:Number,required:!0}},setup($,{emit:y}){const t=Object.freeze({EXPIRED:800,WAITING_SCAN:801,WAITING_CONFIRM:802,SUCCESS:803}),m=y,l=D(),n=f(null),i=f(null);let r=null;const a=async()=>{const h=await H("/login/qr/key",{timestamp:q()});i.value=h.data.data.unikey},u=async()=>{const h=await H("/login/qr/create",{key:i.value,qrimg:!0,timestamp:q()});n.value=h.data.data.qrimg},x=async()=>(await H("/login/qr/check",{key:i.value,timestamp:q()})).data.code,S=async()=>{await a(),await u(),r=setInterval(async()=>{if(l.state.isLogin||$.activeIndex!=0){clearInterval(r);return}const h=await x();t.SUCCESS===h?(clearInterval(r),l.commit("updateLoginState",!0),m("loginSuccess"),console.log("登录成功")):t.EXPIRED===h&&I()},de)};S();const I=()=>{clearInterval(r),S()};return te(()=>$.activeIndex,()=>{$.activeIndex==0&&S()}),j(async()=>{clearInterval(r)}),(h,k)=>n.value?(v(),C("div",ie,[e("img",{onClick:I,src:n.value,style:{width:"200px",height:"200px"}},null,8,ue),k[0]||(k[0]=e("div",{class:"tip"},"请使用网易云音乐app扫码登录",-1))])):N("",!0)}},pe=U(me,[["__scopeId","data-v-6b5085bf"]]),ve={class:"opt-login"},_e={__name:"OPTLogin",setup($,{emit:y}){const t=f({phone:"",code:""}),m={phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{min:11,max:11,message:"请输入正确的手机号",trigger:"blur"}],code:[{required:!0,message:"请输入验证码",trigger:"blur"}]},l=y,n=D(),i=async()=>{await H("/captcha/sent",{phone:t.value.phone})},r=async()=>{(await H("/captcha/verify",{phone:t.value.phone,captcha:t.value.code})).data.code==200&&(n.commit("updateLoginState",!0),l("loginSuccess"))};return(a,u)=>{const x=_("el-input"),S=_("el-form-item"),I=_("el-button"),h=_("el-form");return v(),C("div",ve,[s(h,{rules:m,model:t.value},{default:d(()=>[s(S,{label:"手机号",prop:"phone"},{default:d(()=>[s(x,{modelValue:t.value.phone,"onUpdate:modelValue":u[0]||(u[0]=k=>t.value.phone=k),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),s(S,{label:"验证码",prop:"code"},{default:d(()=>[s(x,{style:{flex:"1"},modelValue:t.value.code,"onUpdate:modelValue":u[1]||(u[1]=k=>t.value.code=k),placeholder:"请输入验证码"},null,8,["modelValue"]),s(I,{onClick:i,style:{"margin-left":"5px",padding:"5px"},type:"primary"},{default:d(()=>u[2]||(u[2]=[M(" 获取验证码 ")])),_:1})]),_:1}),s(S,null,{default:d(()=>[s(I,{style:{width:"100%"},type:"primary",onClick:r},{default:d(()=>u[3]||(u[3]=[M("登录")])),_:1})]),_:1})]),_:1},8,["model"])])}}},ge={class:"login"},fe={__name:"Login",setup($,{emit:y}){const t=y,m=f(0),l=()=>{t("loginSuccess"),console.log("登录成功")},n=i=>{m.value=i.index};return(i,r)=>{const a=_("el-tab-pane"),u=_("el-tabs");return v(),C("div",ge,[s(u,{stretch:"",onTabClick:n},{default:d(()=>[s(a,{label:"验证码登录"},{default:d(()=>[s(pe,{activeIndex:m.value,onLoginSuccess:l},null,8,["activeIndex"])]),_:1}),s(a,{label:"手机号登录"},{default:d(()=>[s(_e,{onLoginSuccess:l})]),_:1})]),_:1})])}}},he={class:"headerbar"},ye={class:"headerbar-left"},Se={class:"search-container"},Ce={key:0,class:"search-history"},Ie=["onClick"],ke={class:"hot-search-list"},xe={class:"headerbar-right"},be={class:"login-container"},$e={class:"user-no-login"},Pe={__name:"HeaderBar",setup($){const y=D(),t=f(!1),m=f(null),l=f(null),n=f(!1),i=f(""),r=f(null),a=f([]),u=async()=>{const c=localStorage.getItem("userInputHistory");c&&(a.value=JSON.parse(c))},x=c=>{a.value.includes(c)||a.value.push(c)},S=c=>{const p=T(c);i.value=p,g(p),x(i.value),h()},I=()=>{g(i.value),x(i.value),h()},h=()=>{localStorage.setItem("userInputHistory",JSON.stringify(a.value))},k=()=>{a.value=[],localStorage.removeItem("userInputHistory")},V=()=>{setTimeout(()=>{n.value=!1},150)},T=c=>c.target.textContent.substring(3).trim(),R=G(),g=c=>{c&&(i.value=c,R.push({name:"searchResult",params:{content:c}}))},o=()=>{const c=localStorage.getItem("uid");R.push({name:"accountDetail",params:{uid:c}})},L=async()=>{const c=await H("/search/hot/detail");l.value=c.data.data},z=async()=>{const c=await H("/user/account",{timestamp:q()});c.data.profile!=null?(m.value=c.data.profile,y.commit("updateLoginState",!0),localStorage.setItem("uid",c.data.profile.userId)):(y.commit("updateLoginState",!1),localStorage.removeItem("userId"))};return u(),z(),L(),(c,p)=>{const X=_("ArrowLeft"),Q=_("el-icon"),Y=_("el-input"),Z=_("el-scrollbar"),K=_("el-avatar"),ee=_("el-popover");return v(),C("div",he,[e("div",ye,[s(Q,{class:"arrow-left",onClick:p[0]||(p[0]=b=>c.$router.go(-1))},{default:d(()=>[s(X)]),_:1}),e("div",Se,[s(Y,{clearable:"",modelValue:i.value,"onUpdate:modelValue":p[1]||(p[1]=b=>i.value=b),style:{height:"40px",width:"300px"},"prefix-icon":"Search",onFocus:p[2]||(p[2]=b=>n.value=!0),onKeyup:oe(I,["enter"]),onBlur:V},null,8,["modelValue"]),n.value?(v(),A(Z,{key:0,class:"search-suggest"},{default:d(()=>[a.value.length>0?(v(),C("div",Ce,[e("div",{class:"title"},[p[5]||(p[5]=e("p",null,"搜索历史",-1)),e("i",{class:"iconfont icon-delete",onClick:k})]),e("div",{class:"historys",ref:r.value},[(v(!0),C(F,null,B(a.value,b=>(v(),C("span",{class:"history",onClick:E=>g(b)},w(b),9,Ie))),256))],512)])):N("",!0),e("div",ke,[p[6]||(p[6]=e("p",{class:"title"},"热搜榜",-1)),(v(!0),C(F,null,B(l.value,(b,E)=>(v(),C("p",{onClick:S,class:"hot-search-item",key:E},[e("span",{style:J({color:E<3?"#FF3727":"#C3C3C3",fontWeight:"bold"})},w(E+1<10?E+1+" ":E+1),5),M(" "+w(b.searchWord),1)]))),128))])]),_:1})):N("",!0)])]),e("div",xe,[e("div",be,[m.value?(v(),C(F,{key:1},[s(K,{size:40,onClick:o,src:m.value.avatarUrl,fit:"cover"},null,8,["src"]),e("div",null,w(m.value.nickname),1)],64)):(v(),A(ee,{key:0,width:300,trigger:"click",onHide:p[3]||(p[3]=b=>t.value=!1),onShow:p[4]||(p[4]=b=>t.value=!0)},{reference:d(()=>[e("div",$e,[s(K,{icon:"UserFilled",size:40,fit:"cover"}),p[7]||(p[7]=e("div",null,"未登录",-1))])]),default:d(()=>[t.value?(v(),A(fe,{key:0,onLoginSuccess:z})):N("",!0)]),_:1}))])])])}}},we=U(Pe,[["__scopeId","data-v-97aea059"]]),Le="/assets/disc-CbjvGCV-.png",Te={class:"music-controller__left"},He=["src"],Ve={class:"music-controller__info"},Re={class:"music-controller__song-name"},Ee={key:0,class:"music-controller__authors"},Ne={class:"music-controller__middle"},Ae={class:"btns"},Fe={class:"progress"},qe=["src"],De={class:"current-time"},Ue=["max"],Me={class:"end-time"},Be={__name:"MusicControler",props:{componentHeight:{type:String,default:"200px"}},setup($){const y=D(),t=y.state.songs,m=f(0),l=se(()=>y.state.currentSongIndex),n=f(null),i=f(null),r=f(0),a=f(!0);let u=null;const x=()=>{l.value!=-1&&(n.value.paused?(n.value.play(),a.value=!1):(n.value.pause(),a.value=!0))},S=()=>{if(!n.value)return;const g=n.value;V(),g.currentTime<g.duration&&(u=requestAnimationFrame(S))},I=()=>{l.value!=-1&&(y.commit("playNextSong"),n.value.load())},h=()=>{l.value!=-1&&(y.commit("playPrevSong"),n.value.load())},k=()=>{if(!i.value)return;const g=i.value,o=(g.value-g.min)/(g.max-g.min)*100;g.style.background=`linear-gradient(to right, #FC3D49 ${o}%, #eee ${o+8}%)`,m.value=g.value,n.value.currentTime=g.value},V=()=>{const g=n.value,o=i.value;m.value=g.currentTime,o.value=g.currentTime;const L=(o.value-o.min)/(o.max-o.min)*100;o.style.background=`linear-gradient(to right, #FC3D49 ${L}%, #eee ${L+8}%)`},T=()=>{r.value=n.value.duration},R=()=>{S(),n.value.play(),a.value=!1};return j(()=>{u&&cancelAnimationFrame(u)}),(g,o)=>(v(),C("div",{class:"music-controller",style:J({height:$.componentHeight})},[e("div",Te,[e("div",{class:W(["music-controller__disc","music-controller__disc--rotate",a.value&&"music-controller__disc--paused"])},[e("img",{src:P(t)[l.value]?P(t)[l.value].cover:"/src/assets/images/disc-default.png"},null,8,He),o[3]||(o[3]=e("img",{src:Le,class:"music-controller__disc-bg"},null,-1))],2),e("div",Ve,[e("p",Re,w(l.value!=-1?P(t)[l.value].name:"暂无音乐播放"),1),l.value!=-1?(v(),C("div",Ee,w(P(ce)(P(t)[l.value].authors)),1)):N("",!0),o[4]||(o[4]=e("div",{class:"btns"},null,-1))])]),e("div",Ne,[e("div",Ae,[o[5]||(o[5]=e("i",{class:"iconfont icon-love0"},null,-1)),e("i",{onClick:I,class:"iconfont icon-previous"}),e("i",{onClick:x,class:W(["iconfont",a.value?"icon-play":"icon-pause"])},null,2),e("i",{onClick:h,class:"iconfont icon-next"}),o[6]||(o[6]=e("i",{class:"iconfont icon-order"},null,-1))]),e("div",Fe,[e("audio",{ref_key:"audioPlayerRef",ref:n,src:l.value!=-1?P(t)[l.value].url:"",preload:"auto",onPlay:o[0]||(o[0]=L=>a.value=!1),onPause:o[1]||(o[1]=L=>a.value=!0),onLoadeddata:T,onCanplaythrough:R,onEnded:I},null,40,qe),e("div",De,w(P(O)(m.value)),1),ne(e("input",{onInput:k,ref_key:"songProgressRef",ref:i,type:"range",min:"0",max:r.value,"onUpdate:modelValue":o[2]||(o[2]=L=>m.value=L)},null,40,Ue),[[ae,m.value]]),e("div",Me,w(P(O)(r.value)),1)])]),o[7]||(o[7]=e("div",{class:"music-controller__right"},[e("i",{class:"iconfont icon-volum2"}),e("i",{class:"iconfont icon-playlist"})],-1))],4))}},We=U(Be,[["__scopeId","data-v-caabf645"]]),ze={class:"logo"},Ke={style:{"margin-left":"5px"}},Oe={__name:"Index",setup($){const y=f([{name:"发现音乐",path:"/discoverMusic",class:"iconfont icon-find"},{name:"视频",path:"/video",class:"iconfont icon-vedio"},{name:"收藏",path:"/collect",class:"iconfont icon-collect"},{name:"每日推荐",path:"/dailyRecommend",class:"iconfont icon-daliy"}]),t=f("/discoverMusic"),m=G(),l=r=>{r!=t.value&&(t.value=r,m.push(r))},n=re();return(()=>{y.value.forEach(r=>{if(r.path==n.path){t.value=r.path;return}})})(),(r,a)=>{const u=_("ElementPlus"),x=_("el-menu-item"),S=_("el-menu"),I=_("el-aside"),h=_("el-header"),k=_("el-main"),V=_("el-container");return v(),C(F,null,[s(V,{class:"index"},{default:d(()=>[s(I,null,{default:d(()=>[e("div",ze,[s(u,{style:{width:"60px",height:"60px",color:"red"}}),a[0]||(a[0]=e("span",{style:{font:"1.2em bold"}},"MusicPlayer",-1))]),s(S,{onSelect:l,router:!0,"default-active":t.value,"show-timeout":300,"hide-timeout":300},{default:d(()=>[(v(!0),C(F,null,B(y.value,(T,R)=>(v(),A(x,{key:R,index:T.path},{default:d(()=>[e("i",{class:W(T.class)},null,2),e("span",Ke,w(T.name),1)]),_:2},1032,["index"]))),128))]),_:1},8,["default-active"])]),_:1}),s(V,null,{default:d(()=>[s(h,null,{default:d(()=>[s(we)]),_:1}),s(k,null,{default:d(()=>[(v(),A(P(le),{key:r.$route.fullPath}))]),_:1})]),_:1})]),_:1}),s(We,{componentHeight:"13vh"})],64)}}},Ye=U(Oe,[["__scopeId","data-v-2e0f07c2"]]);export{Ye as default};
